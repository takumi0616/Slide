# SITA 学会発表：構造類似度指標の統合によるSOM気圧配置分類法の一考察

## 発表情報

- **タイトル**：構造類似度指標の統合によるSOM気圧配置分類法の一考察
- **英題**：Synoptic Pattern Classification via Integrated Structural Similarity Metrics in SOM
- **著者**：高須賀匠（長岡技術科学大学）
- **共著者**：高野雄紀（気象研究所）、渡邊正太郎（株式会社ウェザーマップ）、雲居玄道（長岡技術科学大学）
- **会議**：The 48th Symposium on Information Theory and its Applications (SITA2025)
- **開催地**：Koriyama, Fukushima, Japan
- **開催日**：Nov. 25–28, 2025

## 研究背景

### 気圧配置パターン分類の重要性

総観規模の気圧配置パターン分類は、気象予報、気候システムの理解、防災・減災の各分野において基盤となる重要な技術である。従来は専門家による主観的な分類が行われてきたが、以下の課題がある：

- 多大な労力と時間が必要
- 再現性の確保が困難
- 拡張性に限界がある
- 主観的なばらつき（ノイズ）が生じる

これらの課題を解決するため、客観的かつ自動的な分類手法の開発が求められている。

### 既存手法の問題点

#### 教師あり学習のアプローチ

木村ら（2009）はサポートベクターマシン（SVM）を用いて「冬型」や「南高北低型」などを自動検出する研究を行った。しかし、以下の課題が指摘されている：

- ラベル付けコストが高い
- 主観のばらつきによる学習データの品質問題
- 拡張性の限界

#### 教師なし学習（SOM）のアプローチ

自己組織化マップ（SOM）は、総観パターンの複雑な非線形構造を可視化・圧縮する有効な手段として用いられてきた。多くの従来研究ではユークリッド距離を基本としているが、以下の限界がある：

- 勾配（前線の鋭さ）の評価が不十分
- 形状（等圧線のパターン）の評価が困難
- 位置情報の扱いが適切でない
- 構造的な類似性を捉えきれない

### 本研究の着眼点

構造類似度指標をSOMに統合することで、従来手法の限界を克服する。具体的には：

- **形状と鋭さの同時評価**：S1（勾配差）とKAPPA（曲率）を統合
- **相補的な特徴量の活用**：異なる物理的意味を持つ距離指標のRMS統合
- **代表性の向上**：True Medoidによる実データの鋭さ保持

## 自己組織化マップ（SOM）の基礎

### SOMとは

SOMは、高次元データを低次元（通常2次元）のマップに写像する教師なし学習手法である。データの構造を保持しながら次元削減を行い、可視化を可能にする。

### Batch-SOMアルゴリズム

本研究では、GPU対応のミニバッチ版バッチSOMを実装した。アルゴリズムの流れは以下の通り：

#### 1. 初期化

- M = mx × my 個のノードを2次元格子上に配置
- 各ノードの重みベクトルをランダムまたはデータからサンプリングで初期化

#### 2. BMU探索（Best Matching Unit）

各入力xiに対して、距離関数d(·,·)により最良一致ユニット（BMU）を決定：

```
c(i) = argmin_j d(xi, wj)
```

#### 3. 近傍関数

BMUを中心としたガウス関数を使用：

```
h_c(i),j = exp(-||r_c(i) - r_j||^2 / (2σ(t)^2))
```

ここで、r_jはノードjのグリッド座標、σ(t)は学習進行に応じて減衰する近傍幅。

#### 4. 重み更新

ミニバッチ内で分子・分母を累積し、一括更新：

```
w_new_j = (Σ h_c(i),j * xi) / (Σ h_c(i),j)
```

#### 5. 近傍幅の減衰

σ(t)は学習全体で単調減少（漸近減衰）：

```
σ(t) = σ_0 / (1 + t/(T/2))
```

### 距離関数の重要性

**距離関数d(·,·)の選択がBMU決定、ひいては学習結果全体に決定的な影響を与える**。本研究では8つの距離関数を比較評価した。

## 従来の距離関数

### Euclidean（ユークリッド距離）

最も基本的な距離で、値の差の総量を測定：

```
d_EUC(x, w) = sqrt(Σ(x(s) - w(s))^2 + ε)
```

- **利点**：計算が単純で高速
- **欠点**：構造や勾配の情報を捉えられない

### S1（Teweles-Wobus Score）

一次差分（勾配）の相対誤差に基づき、前線帯の鋭さ・広がり・配置の一致を測定：

```
d_S1 = 100 × Σ|∇x - ∇w| / (Σmax(|∇x|, |∇w|) + ε)
```

- **利点**：前線の鋭さを定量化、気象学的に妥当
- **特徴**：加法定数に不変

### SSIM5（構造類似度指標）

5×5局所窓で平均・分散・共分散を計算し、明るさ・コントラスト・構造の一致度を測定：

```
d_SSIM5 = 1 - (1/|Ω|) Σ SSIM_map
```

- **利点**：人間の視覚認知と整合
- **特徴**：局所構造（形状・位置・コントラスト）を評価

## 提案手法

### 新規距離関数

#### GSSIM（勾配構造類似度）

SSIMの概念を勾配場へ拡張：

- 勾配強度の一致を評価
- 勾配方向の一致を評価
- 強いエッジを重視（max(Gx, Gw)による重み付け）

**特徴**：
- エッジ検出の観点から構造を捉える
- 方向と強度の両面を評価

#### KAPPA（曲率距離）

正規化勾配の発散（曲率）から等圧線の曲がりを評価：

```
d_KAPPA = 0.5 × Σ|κ(x) - κ(w)| / (Σmax(|κ(x)|, |κ(w)|) + ε)
```

ここで、κ(z) = ∇·(∇z/||∇z||)は曲率を表す。

**特徴**：
- 高低気圧の閉じた構造を評価
- 渦度場の特徴を抽出
- 等圧線の凹凸を定量化

### 複合手法（RMS統合）

異なる物理的意味を持つ距離指標をRoot Mean Square（RMS）で統合する新しい手法を提案。

#### RMS統合の理論的根拠

1. **スケール不変性**
   - 各距離指標は異なるスケールを持つ
   - min-max正規化により[0,1]区間に標準化

2. **ユークリッド的統合**
   - RMSは多次元空間でのユークリッド距離に相当
   - 各正規化された距離を独立な次元と見なす

3. **外れ値への感度**
   - 算術平均よりも大きな値に敏感
   - 重要な差異を適切に反映

4. **係数フリー**
   - 正規化により重み係数の調整が不要
   - 実用上の大きな利点

#### 行方向min-max正規化

入力xを固定し、全候補w'に対してmin-max正規化：

```
d̃(x, w) = (d(x,w) - min_w' d(x,w')) / (max_w' d(x,w') - min_w' d(x,w') + ε)
```

これにより、候補間の相対的な順位関係に基づくBMU選択が可能となる。

#### 提案する3つの複合手法

**1. S1,KA（S1 + KAPPA）**
- 勾配の鋭さ（S1）+ 曲率（KAPPA）
- RMS統合：sqrt((d̃_S1^2 + d̃_KAPPA^2) / 2)

**2. GS,KA（GSSIM + KAPPA）**
- エッジの強さ・向き（GSSIM）+ 曲率（KAPPA）
- RMS統合：sqrt((d_GSSIM^2 + d̃_KAPPA^2) / 2)

**3. S1,GS,KA（S1 + GSSIM + KAPPA）**
- 鋭さ + 方向 + 曲率の三要素統合
- RMS統合：sqrt((d̃_S1^2 + d_GSSIM^2 + d̃_KAPPA^2) / 3)

### True Medoid表現

#### Centroid（従来手法）の問題点

- 割り当てサンプルの平均を代表とする
- 勾配が平滑化される
- 「雪だるま現象」が発生
- 台風中心が不明瞭になる

#### True Medoid（提案手法）の利点

各ノードに割り当てられたサンプル集合Icに対し、ノード内総距離が最小となる実サンプルを選択：

```
i* = argmin_{i∈Ic} Σ_{j∈Ic} d(Xj, Xi)
```

**利点**：
- 実データの鋭さを保持
- 解釈性の向上
- 検索性の向上
- 専門家による一貫したラベル付けが可能

## 実験設定

### データセット

- **物理量**：海面更正気圧（SLP）
- **領域**：日本周辺域（15–55°N, 115–155°E）
- **期間**：
  - 学習期：1991–1997年（7年間）
  - 検証期：1998–2000年（3年間）
- **時刻**：日次09 JST
- **ラベル**：吉野の「気圧配置ごよみ」準拠（基本型15種）

### 前処理

1. PaからhPaへ変換
2. 各サンプルの空間平均（領域平均）を差し引く
3. 偏差場として入力

### SOM設定

- **マップサイズ**：10 × 10（100ノード）
- **反復回数**：1000
- **バッチサイズ**：128
- **近傍関数**：ガウス関数
- **初期近傍幅**：σ = 2.5（学習全体で減衰）
- **学習率**：0.5
- **試行回数**：N = 50（シード値1～50）

### 評価指標

#### Macro Recall（マクロ再現率）

各基本ラベルの再現率の平均：

- 混同行列は「基本ラベル vs クラスタ列」で集計
- 各ラベルについて、代表クラスタ群の合計正解数から再現率を算出
- 全ラベルの再現率を平均

#### NodewiseMatchRate

各ノードの多数決（基本ラベル）とtrue medoidの基本ラベルの一致率：

- ノード代表性を評価
- 解釈性の指標

### ラベル体系の詳細

吉野（2002）の「気圧配置ごよみ」に準拠した15種の基本型：

**1. 西高東低冬型（1）**
- 冬季のシベリア高気圧とアリューシャン低気圧

**2. 気圧の谷型（2A, 2B, 2C, 2D）**
- 2A：北海道・サハリン付近を東進
- 2B：日本海から北東進
- 2C：台湾から太平洋岸を東進
- 2D：二つ玉低気圧

**3. 移動性高気圧型（3A, 3B, 3C, 3D）**
- 3A：日本の北方を東進
- 3B：本州上を東進
- 3C：帯状高気圧
- 3D：太平洋岸を東進

**4. 前線型（4A, 4B）**
- 4A：東西前線（本州上）
- 4B：南方前線

**5. 南高北低夏型（5）**
- 北太平洋高気圧が日本を支配

**6. 台風型（6A, 6B, 6C）**
- 6A：南九州より南方
- 6B：本州付近
- 6C：北日本

## 実験結果

### 全体性能比較（N=50試行）

#### 学習期のMacro Recall

| 手法 | Mean | Std | Min | Median | Max |
|------|------|-----|-----|--------|-----|
| **S1,KA** | **0.37** | **0.02** | 0.31 | 0.37 | 0.41 |
| **S1,GS,KA** | **0.37** | **0.02** | 0.30 | 0.37 | 0.41 |
| **GS,KA** | **0.37** | **0.02** | 0.31 | 0.37 | 0.41 |
| S1 | 0.36 | 0.02 | 0.31 | 0.36 | 0.44 |
| GSSIM | 0.35 | 0.02 | 0.30 | 0.35 | 0.40 |
| SSIM5 | 0.32 | 0.02 | 0.28 | 0.32 | 0.40 |
| Euclidean | 0.30 | 0.02 | 0.27 | 0.30 | 0.34 |
| KAPPA | 0.30 | 0.01 | 0.27 | 0.30 | 0.35 |

#### 検証期のMacro Recall（汎化性能）

| 手法 | Mean | Std | Min | Median | Max |
|------|------|-----|-----|--------|-----|
| **S1,KA** | **0.23** | **0.02** | 0.19 | 0.22 | 0.28 |
| S1 | 0.21 | 0.02 | 0.18 | 0.21 | 0.25 |
| KAPPA | 0.21 | 0.02 | 0.17 | 0.21 | 0.24 |
| GS,KA | 0.21 | 0.01 | 0.19 | 0.21 | 0.24 |
| S1,GS,KA | 0.22 | 0.02 | 0.18 | 0.22 | 0.25 |
| GSSIM | 0.21 | 0.02 | 0.18 | 0.21 | 0.25 |
| SSIM5 | 0.17 | 0.01 | 0.15 | 0.17 | 0.20 |
| Euclidean | 0.18 | 0.01 | 0.16 | 0.18 | 0.20 |

**S1,KAが検証期で最高の汎化性能（0.23 ± 0.02）を示した。**

#### NodewiseMatchRate（学習期）

| 手法 | Mean | Std | Min | Median | Max |
|------|------|-----|-----|--------|-----|
| **Euclidean** | **0.31** | **0.03** | 0.24 | 0.31 | 0.39 |
| KAPPA | 0.29 | 0.03 | 0.20 | 0.29 | 0.36 |
| SSIM5 | 0.28 | 0.04 | 0.21 | 0.28 | 0.38 |
| GSSIM | 0.27 | 0.04 | 0.19 | 0.27 | 0.38 |
| S1 | 0.27 | 0.04 | 0.17 | 0.27 | 0.42 |
| S1,KA | 0.25 | 0.03 | 0.18 | 0.29 | 0.41 |
| GS,KA | 0.25 | 0.05 | 0.18 | 0.28 | 0.39 |
| S1,GS,KA | 0.24 | 0.04 | 0.21 | 0.28 | 0.37 |

### ラベル別性能

#### 検証期における非ゼロ再現率のラベル数

| 手法 | 検出ラベル数 | 主な検出ラベル |
|------|-------------|---------------|
| **S1** | **11/15** | 1, 2A, 2D, 3B, 4A, 4B, 5 など |
| S1,GS,KA | 10/15 | 1, 2A, 2D, 3A, 3B, 4A, 4B, 5, 6B |
| GS,KA | 10/15 | 1, 2A, 2D, 3A, 3B, 4A, 4B, 5 |
| GSSIM | 10/15 | 1, 2A, 2D, 3A, 3B, 4A, 4B, 5, 6B |
| S1,KA | 8/15 | 1, 2A, 2D, 3B, 4A, 4B, 5 |
| KAPPA | 7/15 | 1, 2A, 2D, 3B, 4A, 5 |
| Euclidean | 7/15 | 1, 2A, 2D, 3B, 4A, 5 |
| SSIM5 | 7/15 | 1, 2C, 2D, 3B, 4A, 4B, 5 |

#### 安定して検出されるラベル

検証期でも高い再現率を維持：

- **1（西高東低冬型）**：0.86～0.95
- **3B（移動性高気圧：本州上）**：0.73～0.85
- **4A（東西前線）**：0.51～0.74

#### 検出が困難なラベル

多くの手法で検出ゼロまたは低再現率：

- **2C（太平洋岸低気圧）**
- **3C（帯状高気圧）**
- **3D（南岸高気圧）**
- **台風系（6A/6B/6C）**

理由：事例数の少なさ、場の多様性の高さ

### 可視化結果

#### Centroid vs True Medoid

**Centroid（平均）の問題**：
- 平均化により鋭さが失われる
- 「雪だるま現象」が顕著
- 台風中心が不明瞭
- ラベル付けが困難

**True Medoidの利点**：
- 実データの鋭さを保持
- 位相情報が維持される
- 明瞭な気圧配置
- 一貫したラベル付けが可能

色付けノード（ノード多数決ラベルとmedoidの基本ラベルが一致）：
- 青：西高東低冬型（1）
- 黄：二つ玉低気圧（2D）
- オレンジ：移動性高気圧（3B）
- ピンク：前線（4A）
- 紫：前線（4B）
- 赤：南高北低夏型（5）
- 緑：台風（6B）

## 考察

### 手法の特性と補完性

#### 単一手法の特徴

**S1（Teweles-Wobus Score）**
- 前線帯の鋭さを評価
- 気象学的に妥当性が高い
- 勾配差の比率に基づく

**GSSIM（勾配構造類似度）**
- エッジ検出の観点
- 方向と強度を評価
- 強いエッジを重視

**KAPPA（曲率距離）**
- 高低気圧の閉じた構造
- 渦度場の特徴抽出
- 等圧線の曲がりを定量化

#### 複合手法の利点

**S1,KA**
- 勾配（前線の鋭さ）+ 曲率（幾何構造）
- 総観規模現象の包括的評価
- 最高の汎化性能

**RMS統合の理論的根拠**
- スケール不変性（正規化により実現）
- ユークリッド的統合（多次元距離）
- 係数フリー（調整不要）

### 汎化性能の解釈

#### S1,KAが検証期で最良となった理由

1. **形状と鋭さの同時評価**
   - S1：勾配差（前線の鋭さ）に敏感
   - KAPPA：曲率（幾何構造）を評価

2. **BMU探索の頑健性向上**
   - 相補的な特徴量の統合
   - 過学習の抑制

3. **総観規模現象への適合性**
   - 前線、高低気圧、渦度を包括的に捉える

#### 用途に応じた使い分け

- **識別優先**：S1,KA（Macro Recall重視）
- **代表性優先**：Euclidean（NodewiseMatchRate重視）
- **カバレッジ優先**：S1（検出ラベル数重視）

### ラベル不均衡への対応

#### 現状の課題

- 台風系（6A/6B/6C）の出現頻度が極端に低い
  - 6A：7件（0.19%）
  - 6B：15件（0.41%）
  - 6C：2件（0.05%）
- 複合場が約半数を占める（52.7%）
- 検証期で再現率が低下

#### 今後の改善方向

**季節別SOMの導入**
- 冬季SOM：西高東低冬型に特化
- 梅雨期SOM：前線型に特化
- 台風季SOM：台風型に特化

**階層的分類**
- 第1層：大局型の分類
- 第2層：サブタイプの分類

**外部事象フラグの併用**
- 台風客観解析データの活用
- 前線解析結果の参照

## 結論

### 本研究の貢献

1. **厳密な距離指標比較**
   - Batch-SOM上で8つの距離指標を同一条件で評価
   - 既存手法：S1, SSIM5, Euclidean
   - 提案手法：KAPPA, GSSIM, S1,KA, GS,KA, S1,GS,KA

2. **最高の汎化性能**
   - S1,KAが検証Macro Recall: 0.23 ± 0.02を達成
   - 勾配と曲率の相補的統合が有効

3. **解釈性の向上**
   - True medoidによる実データの鋭さ保持
   - 専門家による一貫したラベル付けが可能
   - 「雪だるま現象」の回避

### 実用的推奨

**実運用ではS1,KAを標準距離とする構成を推奨**：
- 高い汎化性能（検証期で最良）
- 総観規模現象の包括的評価
- 前線と高低気圧の両方を捉える

## 今後の課題

### 短期的な改善

**多変量拡張**
- 複数の気象要素（気温、湿度、風など）を統合
- より包括的な気圧配置の特徴抽出

**季節別最適化**
- 季節ごとにSOMを構築
- 季節特有のパターンに最適化

**階層的分類**
- 大局型からサブタイプへの2段階分類
- より細かい気圧配置の識別

### 長期的な展望

**深層学習との融合**
- SOMを深層学習モデルの初期化に活用
- エンドツーエンドの学習

**リアルタイム分類**
- 運用システムへの実装
- 気象予報への実用化

**気候変動研究への応用**
- 長期トレンドの分析
- 気圧配置パターンの変化の検出

## 謝辞

### データ提供

- 気象庁：海面更正気圧データ
- 吉野正敏博士：「気圧配置ごよみ」

### 計算資源

- 長岡技術科学大学：GPU計算環境

### 参考文献（主要）

1. Kohonen (1990) "The self-organizing map"
2. Doan et al. (2021) "S-som v1.0: structural self-organizing map"
3. Sato & Kusaka (2021) "Statistical inter-comparison of similarity metrics"
4. Winderlich et al. (2024) "Classification with modified SSIM"
5. 木村ら (2009) "SVMを用いた気
